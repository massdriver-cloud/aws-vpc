schema: draft-07
name: aws-vpc
description: AWS VPC includes best-practice AWS reference architecture for VPCs and subnets.
ref: github.com/massdriver-cloud/aws-vpc
access: public
type: bundle

steps:
  - path: src
    provisioner: terraform

params:
  examples:
    - __name: Small Development Network (4K IPs)
      cidr: "10.0.0.0/20"
      high_availability: false
      enable_flow_logs: false
    - __name: Large Production Network (65K IPs)
      cidr: "10.0.0.0/16"
      high_availability: true
      enable_flow_logs: true
  required:
    - aws_region
    - cidr
  properties:
    aws_region:
      $ref: https://raw.githubusercontent.com/massdriver-cloud/artifact-definitions/main/definitions/types/aws-region.json
    cidr:
      $ref: https://raw.githubusercontent.com/massdriver-cloud/artifact-definitions/main/definitions/types/cidr.json
    high_availability:
      type: boolean
      title: NAT Gateway High Availability
      description: Provision NAT Gateways in all availability zones so private subnets stay up in the event of a zonal failure
      default: true
    enable_flow_logs:
      type: boolean
      title: Enable VPC Flow Logs
      description: Enable sending VPC traffic logs to Cloudwatch logs for auditing.
      default: true

connections:
  required:
    - aws_authentication
  properties:
    aws_authentication:
      $ref: massdriver/aws-iam-role

artifacts:
  required:
    - vpc
  properties:
    vpc:
      $ref: massdriver/aws-vpc

ui:
  ui:order:
    - aws_region
    - cidr
    - high_availability
    - enable_flow_logs
    - "*"
